!function e(t,a,n){function r(i,s){if(!a[i]){if(!t[i]){var l="function"==typeof require&&require;if(!s&&l)return l(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[i]={exports:{}};t[i][0].call(d.exports,function(e){var a=t[i][1][e];return r(a?a:e)},d,d.exports,e,t,a,n)}return a[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e,t){var a,n,r,o,i,s,l,c,d,u,p,f=[].indexOf||function(e){for(var t=0,a=this.length;a>t;t++)if(t in this&&this[t]===e)return t;return-1};n=void 0,d=864e5,l=new GMaps({el:"#govmap",lat:37.3,lng:-119.3,zoom:6,minZoom:6,scrollwheel:!0,mapTypeControl:!1,panControl:!1,mapTypeControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL},markerClusterer:function(e){var t;return t={textSize:14,textColor:"red",gridSize:0,minimumClusterSize:5,ignoreHidden:!0,legend:{City:"red","School District":"blue","Special District":"purple"}},new MarkerClusterer(e,[],t)}}),l.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById("legend")),p=function(){var e,t,n,r,o;for(r=GOVWIKI.markers,o=[],e=0,t=r.length;t>e;e++)n=r[e],o.push(a(n));return o},u=function(){var e;return e=["City","School District","Special District","County"],GOVWIKI.gov_type_filter_2=[],$(".type_filter").each(function(t,a){var n;return n=$(a).attr("name"),f.call(e,n)>=0&&"1"===$(a).val()?GOVWIKI.gov_type_filter_2.push($(a).attr("name")):void 0})},i=function(e,t){return $.ajax({url:"/api/government/get-markers-data",data:{altTypes:e,limit:5e3},dataType:"json",cache:!0,success:t,error:function(e){return console.log(e)}})},$(function(){var e,t;return u(),e=window.localStorage.getItem("points"),t=new Date,e&&Number(window.localStorage.getItem("points_last_update"))+d>=t.getTime()?(console.log("From cache"),GOVWIKI.markers=JSON.parse(e),$(document).trigger("markersLoaded"),p()):i(GOVWIKI.gov_type_filter_2,function(e){return console.log("From server"),window.localStorage.setItem("points",JSON.stringify(e)),t=new Date,window.localStorage.setItem("points_last_update",t.getTime()),GOVWIKI.markers=e,$(document).trigger("markersLoaded"),p()}),$("#legend li:not(.counties-trigger)").on("click",function(){var e,t,a,n,r,o,i;for($(this).toggleClass("active"),t=$(this).find("input"),i=t.val(),t.val("1"===i?"0":"1"),e=t.attr("name"),u(),o=l.markers,a=0,n=o.length;n>a;a++)r=o[a],r.type===e&&("1"===i?l.markerClusterer.removeMarker(r,!0):l.markerClusterer.addMarker(r,!0));return l.markerClusterer.repaint()}),$("#legend li.counties-trigger").on("click",function(){var e,t,a,n,r,o,i,s,c;if($(this).toggleClass("active"),$(this).hasClass("active")){for(o=l.polygons,s=[],e=0,a=o.length;a>e;e++)r=o[e],s.push(r.setVisible(!0));return s}for(i=l.polygons,c=[],t=0,n=i.length;n>t;t++)r=i[t],c.push(r.setVisible(!1));return c})}),o=function(e){var t;switch(t=function(e){return{path:google.maps.SymbolPath.CIRCLE,fillOpacity:1,fillColor:e,strokeWeight:1,strokeColor:"white",scale:6}},e){case"City":return t("red");case"School District":return t("blue");case"Special District":return t("purple");default:return t("white")}},s=function(e,t){var a,n,r;for(a=0,r=t.length;r>a;a++)if(n=t[a],n===e)return!0;return!1},a=function(e){var t,a;return t=s(e.altType,GOVWIKI.gov_type_filter_2),t===!1?!1:(a=new google.maps.Marker({position:new google.maps.LatLng(e.latitude,e.longitude),icon:o(e.altType),title:e.name+", "+e.type,type:e.altType}),a.addListener("click",function(){var t;return $("#details").hide(),$("#searchContainer").hide(),$("#dataContainer").show(),$("#wikipediaContainer").hide(),$(".loader").show(),$("#stantonIcon").show(),$("#searchIcon").show(),console.log("Click on marker"),t=e.altTypeSlug+"/"+e.slug,console.log(t),jQuery.get(t,{},function(e){return e?$.ajax({url:"/api/government/"+t,dataType:"json",cache:!0,success:function(e){var a,n;return n=e,$(".loader").hide(),$("#details").show(),a=GOVWIKI.templates.get_html(0,n),GOVWIKI.tplLoaded=!0,window.history.pushState({template:a},"CPC Civic Profiles",t),$("#details").html(a),GOVWIKI.show_data_page()},error:function(e){return console.log(e)}}):void 0})}),l.addMarker(a))},c=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=Z|7777BB|FFFFFF",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),r=function(e,t){return GMaps.geocode({address:e,callback:function(e,a){var n;"OK"===a&&(n=e[0].geometry.location,l.setCenter(n.lat(),n.lng()),l.addMarker({lat:n.lat(),lng:n.lng(),size:"small",title:e[0].formatted_address,infoWindow:{content:e[0].formatted_address}}),t&&l.addMarker({lat:t.latitude,lng:t.longitude,size:"small",color:"blue",icon:c,title:t.latitude+" "+t.longitude,infoWindow:{content:t.latitude+" "+t.longitude}}),$(".govmap-found").html("<strong>FOUND: </strong>"+e[0].formatted_address))}})},t.exports={map:l}},{}],2:[function(e,t){var a,n,r=function(e,t){return function(){return e.apply(t,arguments)}};n=e("./querymatcher.coffee"),a=function(){function e(e,t,a){this.html_selector=e,this.num_items=a,this.startSuggestion=r(this.startSuggestion,this),$(document).on("markersLoaded",function(e){return function(){return console.log("Markers loaded"),console.log(GOVWIKI.markers),e.startSuggestion(GOVWIKI.markers)}}(this))}var t,a;return e.prototype.on_selected=function(){},e.prototype.suggestionTemplate=Handlebars.compile('<div class="sugg-box">\n  <div class="sugg-state">{{{state}}}</div>\n  <div class="sugg-name">{{{name}}}</div>\n  <div class="sugg-type">{{{type}}}</div>\n</div>'),t="",a=[],e.prototype.count_govs=function(){var e,t,a,n,r;for(e=0,r=this.govs_array,a=0,n=r.length;n>a;a++)t=r[a],GOVWIKI.state_filter&&t.state!==GOVWIKI.state_filter||GOVWIKI.gov_type_filter&&t.type!==GOVWIKI.gov_type_filter||e++;return e},e.prototype.startSuggestion=function(e){this.govs_array=e,$(".typeahead").keyup(function(e){return function(t){return e.entered_value=$(t.target).val()}}(this)),setTimeout(function(e){return function(){return $(e.html_selector).attr("placeholder","GOVERNMENT NAME")}}(this),1e3),$(this.html_selector).typeahead({hint:!1,highlight:!0,minLength:1,classNames:{menu:"tt-dropdown-menu"}},{name:"name",displayKey:"name",source:n(this.govs_array,this.num_items),templates:{suggestion:this.suggestionTemplate}}).on("typeahead:selected",function(e){return function(t,a,n){return $(".typeahead").typeahead("val",e.entered_value),e.on_selected(t,a,n)}}(this)).on("typeahead:cursorchanged",function(e){return function(){return $(".typeahead").val(e.entered_value)}}(this))},e}(),t.exports=a},{"./querymatcher.coffee":4}],3:[function(e){var t,a,n,r,o,i,s,l,c,d,u,p,f,h,m,g,v,_,y,w,b,I,C,k,x,T,O,S,V,G,W,P;t=e("./govselector.coffee"),a=e("./templates2.coffee"),P=e("./wikipedia.coffee"),_=null,v=null,G=new a,r="",W=null,c=Object.create(null,{}),Handlebars.registerPartial("table-city",$("#table-city").html()),Handlebars.registerPartial("table-county",$("#table-county").html()),Handlebars.registerPartial("table-school-district",$("#table-school-district").html()),Handlebars.registerPartial("table-special-district",$("#table-special-district").html()),Handlebars.registerHelper("getName",function(e,t){return t[e+"Rank"]}),Handlebars.registerHelper("if_eq",function(e,t,a){return e==t?a.fn(this):a.inverse(this)}),Handlebars.registerHelper("some",function(e,t){return!!e[t+"Rank"]}),Handlebars.registerHelper("debug",function(e){var t,a,n,r,o,i,s,l;if(e&&e.contexts){for(i="",l=e.contexts,a=0,r=l.length;r>a;a++)for(t=l[a],n=0,o=t.length;o>n;n++)s=t[n],i+=s+": "+t[s]+"\n";if(console&&console.log)return console.log("Debug\n----------------\n"+i)}}),window.GOVWIKI={state_filter:"",gov_type_filter:"",gov_type_filter_2:["City","School District","Special District"],show_search_page:function(){return $("#dataContainer").hide(),$("#searchIcon").hide(),$("#searchContainer").fadeIn(300),u(500)},show_data_page:function(){return $("#searchIcon").show(),$("#dataContainer").fadeIn(300),$("#searchContainer").hide()}},GOVWIKI.templates=G,GOVWIKI.tplLoaded=!1,GOVWIKI.get_counties=p=function(e){return $.ajax({url:"/legacy/data/county_geography_ca_2.json",dataType:"json",cache:!0,success:function(t){return e(t)}})},GOVWIKI.draw_polygons=d=function(e){var t,a,n,r,o;for(r=e.features,o=[],a=0,n=r.length;n>a;a++)t=r[a],o.push(function(){return function(e){return _.map.drawPolygon({paths:e.geometry.coordinates,useGeoJSON:!0,strokeColor:"#808080",strokeOpacity:.6,strokeWeight:1.5,fillColor:"#FF0000",fillOpacity:.15,countyId:e.properties._id,altName:e.properties.alt_name,marker:new MarkerWithLabel({position:new google.maps.LatLng(0,0),draggable:!1,raiseOnDrag:!1,map:_.map.map,labelContent:e.properties.name,labelAnchor:new google.maps.Point(-15,25),labelClass:"label-tooltip",labelStyle:{opacity:1},icon:"http://placehold.it/1x1",visible:!1}),mouseover:function(){return this.setOptions({fillColor:"#00FF00"})},mousemove:function(e){return this.marker.setPosition(e.latLng),this.marker.setVisible(!0)},mouseout:function(){return this.setOptions({fillColor:"#FF0000"}),this.marker.setVisible(!1)},click:function(){var t;return $(".loader").show(),$("#searchContainer").hide(),$("#dataContainer").show(),t="/"+e.alt_type_slug+"/"+e.properties.slug,$.ajax({url:"/api/government"+t,dataType:"json",cache:!0,success:function(e){var a;return a=G.get_html(0,e),$("#details").html(a),$(".loader").hide(),$("#details").show(),$("#searchIcon").show(),GOVWIKI.tplLoaded=!0,window.history.pushState({template:a},"CPC Civic Profiles",t)}})}})}}(this)(t));return o},window.remember_tab=function(e){return r=e},$(document).on("click","#fieldTabs a",function(e){var t,a,n;return r=$(e.currentTarget).data("tabname"),console.log(r),$("#tabsContent .tab-pane").removeClass("active"),$($(e.currentTarget).attr("href")).addClass("active"),G.activate(0,r),"Financial Statements"===r?(t=0,a=0,n=0,$('.fin-values-block [data-col="1"]').find(".fin-val").each(function(){var e;return e=$(this).width(),e>t?t=e:void 0}),$('.fin-values-block [data-col="2"]').find(".fin-val").each(function(){var e;return e=$(this).width(),e>a?a=e:void 0}),$('.fin-values-block [data-col="3"]').find(".fin-val").each(function(){var e;return e=$(this).width(),e>n?n=e:void 0}),$('.fin-values-block [data-col="1"] .currency-sign').css("right",t+27),$('.fin-values-block [data-col="2"] .currency-sign').css("right",a+27),$('.fin-values-block [data-col="3"] .currency-sign').css("right",n+27)):void 0}),$(document).tooltip({selector:"[class='media-tooltip']",trigger:"click"}),n=function(){return $("#fieldTabs a[href='#tab"+r+"']").tab("show")},g=function(e){return console.log("!!@#@"),$("#wikipediaContainer").html(""),$.ajax({url:"http://46.101.3.79:80/rest/db/govs/"+e,dataType:"json",headers:{"X-DreamFactory-Application-Name":"govwiki"},cache:!0,success:function(e){e&&h(e._id,function(t){return e.financial_statements=t,f(e._id,25,function(t){return e.elected_officials=t,m(function(t){return e.max_ranks=t.record[0],n()})})})},error:function(e){return console.log(e)}})},f=function(e,t,a){return $.ajax({url:"http://46.101.3.79/api/government/"+e+"/"+t,dataType:"json",cache:!0,success:a,error:function(e){return console.log(e)}})},h=function(e,t){return $.ajax({url:"http://46.101.3.79:80/rest/db/_proc/get_financial_statements",data:{app_name:"govwiki",order:"caption_category,display_order",params:[{name:"govs_id",param_type:"IN",value:e}]},dataType:"json",cache:!0,success:t,error:function(e){return console.log(e)}})},m=function(e){return $.ajax({url:"http://46.101.3.79:80/rest/db/max_ranks",data:{app_name:"govwiki"},dataType:"json",cache:!0,success:e})},window.GOVWIKI.show_record=function(){return function(e){return $("#details").html(G.get_html(0,e)),n(),GOVWIKI.show_data_page(),router.navigate(e._id)}}(this),window.GOVWIKI.show_record2=function(){return function(e){return f(e.altTypeSlug,e.slug,function(t){var a;return e.elected_officials=t,$("#details").html(G.get_html(0,e)),n(),GOVWIKI.show_data_page(),a=e.altTypeSlug+"/"+e.slug,document.location.pathname=a})}}(this),l=function(e,t,a,n){return $.ajax({url:"https://api.mongolab.com/api/1/databases/govwiki/runCommand?apiKey=0Y5X_Qk2uOJRdHJWJKSRWk6l6JqVTS2y",type:"POST",contentType:"application/json",dataType:"json",data:a,cache:!0,success:function(){return function(a){var r;r=a.values,s(e,t,r.sort(),n)}}(this),error:function(e){return console.log(e)}})},s=function(e,t,a,n){var r,o,i,s,l;for(i="<select class='form-control' style='maxwidth:160px;'><option value=''>"+t+"</option>",r=0,o=a.length;o>r;r++)l=a[r],l&&(i+="<option value='"+l+"'>"+l+"</option>");return i+="</select>",s=$(i),$(e).append(s),"State.."===t&&(s.val("CA"),window.GOVWIKI.state_filter="CA"),s.change(function(e){var t;return t=$(e.target),window.GOVWIKI[n]=t.val(),$(".gov-counter").text(v.count_govs())})},o=function(){var e,t;return e=$("#myinput"),t=$("#typeahed-container"),e.width(t.width())},V=function(){return $(window).resize(function(){return o()})},u=function(e){return setTimeout(function(){return $("#myinput").focus()},e)},window.onhashchange=function(){var e;return e=window.location.hash,e?void 0:GOVWIKI.show_search_page()},k=document.location.pathname.split("/").filter(function(e){return""!==e?e:!1}),x=k.length,GOVWIKI.history=function(e){var t;return 0===e?(t=$("#searchContainer").text(),""!==t?($("#searchIcon").hide(),$("#stantonIcon").hide()):document.location.pathname="/",$("#details").hide(),$("#searchContainer").show(),!1):null!==history.state&&void 0!==history.state.template?window.history.go(e):(k.pop(),document.location.pathname="/"+k.join("/"))},window.addEventListener("popstate",function(e){if(console.log(window.history.state),null!==window.history.state){if(k=document.location.pathname.split("/").filter(function(e){return""!==e?e:!1}),k=k.length,console.log(k),0===k&&GOVWIKI.show_search_page(),2===k&&$("#stantonIcon").hide(),0!==k)return $("#details").html(e.state.template),GOVWIKI.show_data_page()}else if(GOVWIKI.show_search_page(),GOVWIKI.tplLoaded===!1)return document.location.reload()}),b=function(e,t,a){return DISQUS.reset({reload:!0,config:function(){return this.page.identifier=e,this.page.url=t,this.page.title=a}})},S=function(e,t){var a,n,r,o,i;return o=$(e+" tbody  [data-id]").get(),n=$(e+" tbody  tr:last").get(),a=$(e+" tbody tr:first").children("th").eq(t),r=!0,a.hasClass("desc")?(a.removeClass("desc").addClass("origin"),a.find("i").removeClass("icon__bottom").removeClass("icon__top"),o=a.data("origin"),r=!1):a.hasClass("asc")?(a.removeClass("asc").addClass("desc"),a.find("i").removeClass("icon__bottom").addClass("icon__top"),i=function(e,a){var n,r;return n=$(e).children("td").eq(t).text().toUpperCase().trim(),r=$(a).children("td").eq(t).text().toUpperCase().trim(),r>n?1:n>r?-1:0}):a.hasClass("origin")?(a.removeClass("origin").addClass("asc"),a.find("i").addClass("icon__bottom"),i=function(e,a){var n,r;return n=$(e).children("td").eq(t).text().toUpperCase().trim(),r=$(a).children("td").eq(t).text().toUpperCase().trim(),r>n?-1:n>r?1:0}):(a.addClass("asc"),a.data("origin",o.slice(0)),a.find("i").addClass("icon__bottom"),i=function(e,a){var n,r;return n=$(e).children("td").eq(t).text().toUpperCase().trim(),r=$(a).children("td").eq(t).text().toUpperCase().trim(),r>n?-1:n>r?1:0}),r&&o.sort(i),$.each(o,function(t,a){return $(e).children("tbody").append(a)}),$(e).children("tbody").append(n)},y=function(e){return $('[data-toggle="tooltip"]').tooltip(),$(".editable").editable({stylesheets:!1,type:"textarea",showbuttons:"bottom",display:!0,emptytext:" "}),$(".editable").off("click"),$("table").on("click",".glyphicon-pencil",function(e){return e.preventDefault(),e.stopPropagation(),void 0===e.currentTarget.dataset.noEditable?authorized?$(e.currentTarget).closest("td").find(".editable").editable("toggle"):(showModal("/login"),window.sessionStorage.setItem("tableType",$(e.target).closest(".tab-pane")[0].id),window.sessionStorage.setItem("dataId",$(e.currentTarget).closest("tr").attr("data-id")),window.sessionStorage.setItem("field",Number($(e.currentTarget).closest("td")[0].cellIndex)+1)):void 0}),$(".sort").on("click",function(e){var t;return e.preventDefault(),e.stopPropagation(),t=$(this).attr("data-sort-type"),"year"===t?S('[data-entity-type="Contribution"]',0):"name"===t?S('[data-entity-type="Contribution"]',1):"amount"===t?S('[data-entity-type="Contribution"]',3):"contributor-type"===t?S('[data-entity-type="Contribution"]',4):void 0}),$("a").on("save",function(e,t){var a,n,r,o;return a=$(e.currentTarget).closest("table")[0].dataset.entityType,r=$(e.currentTarget).closest("tr")[0].dataset.id,n=Object.keys($(e.currentTarget).closest("td")[0].dataset)[0],("vote"===n||"didElectedOfficialProposeThis"===n)&&(a="ElectedOfficialVote",r=$(e.currentTarget).parent().find("span")[0].dataset.id),o={editRequest:{entityName:a,entityId:r,changes:{}}},console.log(o),o.editRequest.changes[n]=t.newValue,o.editRequest=JSON.stringify(o.editRequest),$.ajax("/editrequest/create",{method:"POST",data:o,dataType:"text/json",success:function(e){var t;return t=JSON.parse(e.responseText)},error:function(e){return 401===e.status?showModal("/login"):void 0}})}),$("table").on("click",".add",function(t){var a,n,r,o;return r=$(t.target).closest(".tab-pane"),o=r[0].id,authorized?(a=null,console.log(o),"Votes"===o?(a="Legislation",$("#addVotes").modal("toggle").find("form")[0].reset()):"Contributions"===o?(a="Contribution",$("#addContributions").modal("toggle").find("form")[0].reset()):"Endorsements"===o?(a="Endorsement",$("#addEndorsements").modal("toggle").find("form")[0].reset()):"Statements"===o&&(a="PublicStatement",$("#addStatements").modal("toggle").find("form")[0].reset(),$(".url-input").on("keyup",function(){var e;return e=/\b(https?):\/\/([\-A-Z0-9.]+)(\/[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?(\?[A-Z0-9+&@#\/%=~_|!:,.;]*)?/i,e.test($(this).val())?$.ajax("/api/url/extract",{method:"GET",data:{url:$(this).val().match(e)[0]},success:function(e){var t;return console.log(e),t=$("#url-statement"),t.find(".url-content-title").text(""),t.find(".url-content-body").text(""),t.find(".url-content-img").attr("src",""),t.find(".url-content-title").text(e.data.title),"html"===e.type&&(t.find(".url-content-img").hide(),t.find(".url-content-body").text(e.data.body)),"youtube"===e.type&&t.find(".url-content-img").attr("src",e.data.preview),"image"===e.type&&t.find(".url-content-img").attr("src",e.data.preview),t.slideDown()},error:function(e){var t;return console.log(e),t=$("#url-statement"),t.find(".url-content-title").text(""),t.find(".url-content-body").text(""),t.find(".url-content-img").attr("src",""),t.find(".url-content-body").text(e.responseText),t.slideDown()}}):void 0})),r.hasClass("loaded")?!1:(r[0].classList.add("loaded"),n={createRequest:{entityName:a,knownFields:{electedOfficial:e.id}}},$.ajax({method:"POST",url:"/api/createrequest/new",data:n,success:function(e){var t,n,r,o;if(console.log(e),n={},e.choices[0].choices.forEach(function(e){var t;return t=Object.keys(e),t.forEach(function(t){return n[t]=e[t]})}),r=function(){var t,a,r;o.setAttribute("name",e.choices[0].name),a=document.createElement("option"),a.setAttribute("value",""),a.textContent="",o.innerHTML+=a.outerHTML,r=[];for(t in n)a=document.createElement("option"),a.setAttribute("value",t),a.textContent=n[t],r.push(o.innerHTML+=a.outerHTML);return r},o=null,"Endorsement"===a);else if("Contribution"===a);else{if("Legislation"===a)return o=$("#addVotes select")[0],r(),$("#addVotes").find('[data-provide="datepicker"]').on("changeDate",function(){return $(this).datepicker("hide")}),t=Handlebars.compile($("#legislation-vote").html()),$("#electedVotes").html(t(e));if("PublicStatement"===a)return o=$("#addStatements select")[0],r(),$("#addStatements").find('[data-provide="datepicker"]').on("changeDate",function(){return $(this).datepicker("hide")})}},error:function(e){return 401===e.status?showModal("/login"):void 0}}))):(showModal("/login"),window.sessionStorage.setItem("tableType",o),!1)}),window.addItem=function(t){var a,n,r,o,i,s,l,c,d,u,p,f,h,m,g,v,_,y,w,b,I,C;if(p={},d=$(t.target).closest(".modal"),u=d[0].id,i=d[0].dataset.entityType,console.log(i),d.find('input[type="text"]').each(function(e,t){var a;return a=Object.keys(t.dataset)[0],p[a]=t.value}),d.find("textarea").each(function(e,t){var a;return a=Object.keys(t.dataset)[0],p[a]=t.value}),n={},"addVotes"!==u&&(n.electedOfficial=e.id),r=[],"addVotes"===u){if(d.find("#electedVotes").find("tr[data-elected]").each(function(e,t){var a,n,o;return t=$(t),n=Object.create(null,{}),t.find("select").each(function(e,t){var a;return t.value?(a=Object.keys(t.dataset)[0],n[a]=t.value):void 0}),2===Object.keys(n).length?(o=Object.create(null,{}),o.fields=n,o.associations=Object.create(null,{}),o.associations[t.attr("data-entity-type")]=t.attr("data-elected"),a=t.parent().parent().attr("data-entity-type"),r.push({entityName:a,fields:o})):void 0}),_=d.find("select")[0],y=_.name,b=_.options[_.selectedIndex].value,""===b)return window.alert("Please select category."),_.focus(),!1;w=$(_).find(":selected").text(),n[y]=b}else if("addContributions"===u){if(_=d.find("select")[0],y=_.name,b=_.options[_.selectedIndex].value,""===b)return window.alert("Please select type."),_.focus(),!1;w=$(_).find(":selected").text(),p[y]=b}else if("addEndorsements"===u){if(_=d.find("select")[0],y=_.name,b=_.options[_.selectedIndex].value,""===b)return window.alert("Please select type."),_.focus(),!1;w=$(_).find(":selected").text(),p[y]=b}else if("addStatements"===u){if(_=d.find("select")[0],y=_.name,b=_.options[_.selectedIndex].value,""===b)return window.alert("Please select category."),_.focus(),!1;w=$(_).find(":selected").text(),n[y]=b}I={createRequest:{entityName:i,fields:{fields:p,associations:n,childs:r}}},v=Handlebars.compile($("#row-"+u).html()),o=Object.create(null,{}),h=I.createRequest.fields.fields;for(l in h)C=h[l],o[l]=C;if(o.user=user.username,"addVotes"===u){for(a=!1,m=I.createRequest.fields.childs,s=0,c=m.length;c>s;s++)if(f=m[s],Number(f.fields.associations.electedOfficial)===Number(e.id)){a=!0,g=f.fields.fields;for(l in g)C=g[l],o[l]=C;break}a&&(o.category=w,$("#Votes tr:last-child").before(v(o)))}else"addContributions"===u?(o.contributorType=w,o.contributionAmount=numeral(o.contributionAmount).format("0,000"),$("#Contributions tr:last-child").before(v(o))):"addEndorsements"===u?(o.endorserType=w,$("#Endorsements tr:last-child").before(v(o))):"addStatements"===u&&(o.category=w,$("#Statements tr:last-child").before(v(o)));return console.log(I),$.ajax({url:"/api/createrequest/create",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:I,success:function(e){return console.log(e)}}),d.modal("hide")},window.setTimeout(function(){var e,t,a;if(authorized)return a=window.sessionStorage.getItem("tableType"),e=window.sessionStorage.getItem("dataId"),t=window.sessionStorage.getItem("field"),e&&t?($('a[aria-controls="'+a+'"]').click(),$("tr[data-id="+e+"]").find("td:nth-child("+t+")").find(".editable").editable("toggle"),window.sessionStorage.setItem("tableType",""),window.sessionStorage.setItem("dataId",""),window.sessionStorage.setItem("field","")):a?($("div#"+a).find(".add").click(),$('a[aria-controls="'+a+'"]').click(),window.sessionStorage.setItem("tableType","")):void 0},2e3)},O=function(e,t){var a,n,r,o,i,s,l,d,u,p,f,h,m,g;if(authorized){for(s=Handlebars.compile($("#row-addVotes").html()),a=Handlebars.compile($("#row-addContributions").html()),r=Handlebars.compile($("#row-addEndorsements").html()),h=Handlebars.compile($("#row-addStatements").html()),f=[],o=0,l=t.length;l>o;o++){if(p=t[o],n=p.fields.fields,n.user=p.user.username,"Legislation"===p.entity_name){d="Votes",m=s,u=p.fields.childs[0].fields.fields;for(i in u)g=u[i],n[i]=g;n.category=c[p.fields.associations.issueCategory-1].name}else"Contribution"===p.entity_name?(d="Contributions",m=a,n.contributionAmount=numeral(n.contributionAmount).format("0,000")):"Endorsement"===p.entity_name?(d="Endorsements",m=r):"PublicStatement"===p.entity_name&&(d="Statements",m=h,n.category=c[p.fields.associations.issueCategory-1].name);f.push($("#"+d+" tr:last-child").before(m(n)))}return f}},$("#dataContainer").popover({placement:"bottom",selector:".rank",animation:!0,template:'<div class="popover" role="tooltip"> <div class="arrow"></div> <div class="popover-title-custom"> <h3 class="popover-title"></h3> </div> <div class="popover-content"></div> </div>'}),Handlebars.registerHelper("if_eq",function(e,t,a){return e===t?a.fn(this):a.inverse(this)}),Handlebars.registerHelper("concat",function(e,t){var a;return a=[e,t],a.join("")}),$("#dataContainer").on("click",function(e){var t,a,n,r,o,i,s,l,c,d,u,p,f,h,m;return t=$(e.target),d=t.parent().find(".popover-content"),r=t.attr("data-field"),c=t.attr("data-mask"),f=$("#rankPopover").html(),a=$("#additionalRows").html(),h=d.find("loader"),m=0,n=0,l=!1,p=null,u=null,t.closest(".popover")[0]||$(".rank").not(e.target).popover("destroy"),i=function(e){return c?e.data.forEach(function(e){return e.amount=numeral(e.amount).format(c)}):void 0},s=function(){var e,t;return l=!0,h.show(),t=d.find("table tbody"),t.html(""),n=0,m=0,e=r.replace(/_([a-z0-9])/g,function(e){return e[1].toUpperCase()}),$.ajax({url:"/api/government"+window.location.pathname+"/get_ranks",dataType:"json",data:{page:n,order:p,name_order:u,field_name:e},success:function(e){var n;return i(e),n=Handlebars.compile(a),t.html(n(e)),l=!1,h.hide()}})},d.on("click","th",function(e){var t;return t=$(e.target).hasClass("sortable")?$(e.target):$(e.target).closest("th"),t.hasClass("sortable")?t.hasClass("desc")?("name_order"===t.attr("data-sort-type")?u="":p="",s(),t.removeClass("desc").removeClass("asc"),t.find("i").removeClass("icon__bottom").removeClass("icon__top")):t.hasClass("asc")?("name_order"===t.attr("data-sort-type")?u="desc":p="desc",s(),t.removeClass("asc").addClass("desc"),t.find("i").removeClass("icon__top").addClass("icon__bottom")):("name_order"===t.attr("data-sort-type")?u="asc":p="asc",s(),t.addClass("asc"),t.find("i").addClass("icon__top")):void 0}),r&&(o=r.replace(/_([a-z0-9])/g,function(e){return e[1].toUpperCase()}),$.ajax({url:"/api/government"+window.location.pathname+"/get_ranks",dataType:"json",data:{field_name:o},success:function(e){var t;return i(e),t=Handlebars.compile(f),d.html(t(e))}})),d.scroll(function(){var e;return e=d.scrollTop(),e>m&&e>.5*d[0].scrollHeight&&(console.log("asdasd"),m=e,l===!1)?(l=!0,h.show(),$.ajax({url:"/api/government"+window.location.pathname+"/get_ranks",dataType:"json",data:{page:++n,order:p,name_order:u,field_name:o},success:function(e){var t;return i(e),l=!1,h.hide(),t=Handlebars.compile(a),d.find("table tbody")[0].innerHTML+=t(e),console.log(e)}})):void 0})}),$("#dataContainer").on("click",".elected_link",function(e){var t;return e.preventDefault(),t=e.currentTarget.pathname,$("#details").hide(),$("#searchContainer").hide(),$("#dataContainer").show(),$("#wikipediaContainer").hide(),$(".loader").show(),$("#stantonIcon").show(),$("#searchIcon").show(),jQuery.get(t,{},function(e){return e?$.ajax({url:"/api/elected-official"+t,dataType:"json",cache:!0,success:function(e){var a,n,r,o,i,s,l,d,u;for(l=e.person,r=e.createRequests,c=e.categories,l.categories=e.categories,l.gov_alt_name=l.government.slug.replace(/_/g," "),d=l.contributions,i=0,s=d.length;s>i;i++)n=d[i],n.contribution_amount=numeral(n.contribution_amount).format("0,000");return console.log(e),$.isEmptyObject(l)?($(".loader").hide(),$("#details").html("<h2>Sorry. Page not found</h2>"),$("#details").css({textAlign:"center"}),$("#details").show(),$("#dataContainer").show(),!1):(l.votes.forEach(function(e){var t;return t=moment(e.legislation.date_considered,"YYYY-MM-DD"),e.legislation.date_considered=t.format("L")}),u=$("#person-info-template").html(),a=Handlebars.compile(u),$(".loader").hide(),$("#details").show(),o=a(l),GOVWIKI.tplLoaded=!0,window.history.pushState({template:o},"CPC Politician Profiles",t),$("#details").html(o),$("#dataContainer").css({display:"block"}),y(l),O(l,r),$(".vote").on("click",function(e){var t,a;return t=e.currentTarget.id,a=e.currentTarget.dataset.legislationName,void 0===a&&(a=l.full_name),$("#myModalLabel").text(a+" ("+l.gov_alt_name+")"),$("#conversation").modal("show"),b(t,"http://govwiki.us/"+t,a)}),$("#stantonIcon a").text("Return to "+l.gov_alt_name),window.DISQUSWIDGETS.getCount())},error:function(e){return console.log(e)}}):void 0})}),0===x&&($("#stantonIcon").hide(),v=new t(".typeahead","/legacy/data/h_types_ca_2.json",7),v.on_selected=function(e,t){var a;return $("#details").hide(),$("#searchContainer").hide(),$("#dataContainer").show(),$(".loader").show(),$("#wikipediaContainer").hide(),$("#stantonIcon").hide(),a="/"+t.altTypeSlug+"/"+t.slug,jQuery.get(a,{},function(e){return e?$.ajax({url:"/api/government"+a,dataType:"json",cache:!0,success:function(e){var t,r;return r=e,$(".loader").hide(),$("#details").show(),t=G.get_html(0,r),GOVWIKI.tplLoaded=!0,window.history.pushState({template:t},"CPC Civic Profiles",a),$("#details").html(t),n(),GOVWIKI.show_data_page()},error:function(e){return console.log(e)}}):void 0})},W||($("#searchContainer").html($("#search-container-template").html()),_=e("./govmap.coffee"),p(GOVWIKI.draw_polygons),GOVWIKI.tplLoaded=!0,window.history.pushState({template:$("#searchContainer").html()},"CPC Civic Profiles","/"),W=!0,$(".loader").hide()),o(),V(),$("#btnBackToSearch").click(function(e){return e.preventDefault(),GOVWIKI.show_search_page()}),G.load_fusion_template("tabs","https://www.googleapis.com/fusiontables/v2/query?sql=SELECT%20*%20FROM%201z2oXQEYQ3p2OoMI8V5gKgHWB5Tz990BrQ1xc1tVo&key=AIzaSyCXDQyMDpGA2g3Qjuv4CDv7zRj-ix4IQJA"),$("#govmap").on("click",".info-window-uri",function(e){var t;return t=e.target.parentNode.dataset.uri,$(".loader").show(),$("#searchContainer").hide(),$("#dataContainer").show(),$.ajax({url:"/api/government"+t,dataType:"json",cache:!0,success:function(e){var a;return a=G.get_html(0,e),$("#details").html(a),$(".loader").hide(),$("#details").show(),$("#searchIcon").show(),GOVWIKI.tplLoaded=!0,window.history.pushState({template:a},"CPC Civic Profiles",t)}})})),1===x&&(document.title="CPC Civic Profiles",$("#details").hide(),$("#dataContainer").show(),$(".loader").show(),$("#wikipediaContainer").hide(),$("#stantonIcon").hide(),w=[],$(document).on("click",".rank_sort",function(e){var t,a,n,r;return $("#details").hide(),$("#dataContainer").show(),$(".loader").show(),$("#wikipediaContainer").hide(),$("#stantonIcon").hide(),t=$(e.currentTarget),r=t.closest(".tab-pane"),a=t.attr("data-sort-type"),n=t.find("i"),n.hasClass("icon__top")?(n.addClass("icon__bottom").removeClass("icon__top"),w[a]="desc"):n.hasClass("icon__bottom")?(n.removeClass("icon__bottom"),delete w[a]):(n.addClass("icon__top"),w[a]="asc"),$.ajax({url:"/api/rank_order",dataType:"json",data:{alt_type:r.attr("id"),fields_order:$.extend({},w)},cache:!0,success:function(e){var t,a;return console.log(e),a=r.find("table"),t=a.find("tr:first"),$(".loader").hide(),$("#details").show(),GOVWIKI.show_data_page(),GOVWIKI.tplLoaded=!0,window.history.pushState({template:$("#details").html()},"CPC Civic Profiles","/rank_order")}})}),i={},GOVWIKI.currentAltType="City",GOVWIKI.currentAltTypeLowerCase="city",GOVWIKI.itemsPerPage=10,GOVWIKI.currentPage=0,T=function(){return $('a[data-toggle="tab"]').on("shown.bs.tab",function(e){return GOVWIKI.currentAltType=$(e.target).attr("href").replace("#",""),GOVWIKI.currentAltTypeLowerCase=GOVWIKI.currentAltType.toLowerCase(),GOVWIKI.currentPage=0,I()}),$(".pagination").on("click","a",function(e){var t;return t=$(e.target).attr("data-page"),void 0!==t?(GOVWIKI.currentPage=parseInt(t)-1,C(GOVWIKI.currentPage)):void 0})},I=function(){var e,t;return e=$("#"+GOVWIKI.currentAltType+" .pagination"),e.html(""),t="",GOVWIKI.currentPage>0?(t+='<li><a href="javascript:void(0)" aria-label="Previous" onclick="GOVWIKI.prevPage(event)"><span aria-hidden="true">&laquo;</span></a></li>',t+='<li><a href="javascript:void(0)" data-page="'+GOVWIKI.currentPage+'">'+GOVWIKI.currentPage+"</a></li>"):t+='<li class="disabled"><a href="javascript:void(0)" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>',
t+='<li class="active"><a href="javascript:void(0)" data-page="'+(GOVWIKI.currentPage+1)+'">'+(GOVWIKI.currentPage+1)+"</a></li>",GOVWIKI.currentPage===GOVWIKI.lastPage()?t+='<li class="disabled"><a href="javascript:void(0)" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>':(t+='<li><a href="javascript:void(0)" data-page="'+(GOVWIKI.currentPage+2)+'">'+(GOVWIKI.currentPage+2)+"</a></li>",t+='<li><a href="javascript:void(0)" aria-label="Next" onclick="GOVWIKI.nextPage(event)"><span aria-hidden="true">&raquo;</span></a></li>'),e.append(t)},$.ajax({url:"/api/rank_order",dataType:"json",cache:!0,success:function(e){var t;return i=e,t=Handlebars.compile($("#rank-order-page").html()),$("#details").html(t(i)),$(".loader").hide(),$("#details").show(),GOVWIKI.show_data_page(),T(),I(),GOVWIKI.tplLoaded=!0}}),C=function(e){return $.ajax({url:"/api/rank_order",dataType:"json",cache:!0,data:{alt_type:GOVWIKI.currentAltType,page:e||GOVWIKI.currentPage,limit:GOVWIKI.itemsPerPage},success:function(e){var t;return i[GOVWIKI.currentAltTypeLowerCase]=e,t=Handlebars.compile($("#table-"+GOVWIKI.currentAltTypeLowerCase.replace(/_/,"-")).html()),$("#"+GOVWIKI.currentAltType).html(t(i)),T(),I()}})},GOVWIKI.nextPage=function(){return++GOVWIKI.currentPage,C()},GOVWIKI.prevPage=function(){return--GOVWIKI.currentPage,C()},GOVWIKI.firstPage=function(){return 0==GOVWIKI.currentPage},GOVWIKI.lastPage=function(){var e;return e=Math.ceil(i.count/GOVWIKI.itemsPerPage-1),GOVWIKI.currentPage===e},GOVWIKI.numberOfPages=function(){return Math.ceil(i.count/GOVWIKI.itemsPerPage)}),2===x&&(document.title="CPC Civic Profiles",$("#details").hide(),$("#dataContainer").show(),$(".loader").show(),$("#wikipediaContainer").hide(),$("#stantonIcon").hide(),G.load_fusion_template("tabs","https://www.googleapis.com/fusiontables/v2/query?sql=SELECT%20*%20FROM%201z2oXQEYQ3p2OoMI8V5gKgHWB5Tz990BrQ1xc1tVo&key=AIzaSyCXDQyMDpGA2g3Qjuv4CDv7zRj-ix4IQJA"),$.ajax({url:"/api/government"+window.path,dataType:"json",cache:!0,success:function(e){var t;return $(".loader").hide(),$("#details").show(),t=G.get_html(0,e),$("#details").html(t),n(),GOVWIKI.show_data_page(),GOVWIKI.tplLoaded=!0,window.history.pushState({template:t},"CPC Civic Profiles",window.path)},error:function(e){return console.log(e)}}),$("#btnBackToSearch").click(function(e){return e.preventDefault(),GOVWIKI.show_search_page()})),3===x&&(document.title="CPC Politician Profiles",$("#details").hide(),$("#searchContainer").hide(),$("#dataContainer").show(),$("#wikipediaContainer").hide(),$(".loader").show(),$("#stantonIcon").show(),$("#searchIcon").show(),$.ajax({url:"/api/elected-official"+window.path,dataType:"json",success:function(e){var t,a,n,r,o,i,s,l,d,u,p,f;for(u=e.person,r=e.createRequests,c=e.categories,u.category_select=[],u.gov_alt_name=u.government.slug.replace(/_/g," "),i=0,l=c.length;l>i;i++)t=c[i],u.category_select.push({value:t.id,text:t.name});for(u.category_select=JSON.stringify(u.category_select),p=u.contributions,s=0,d=p.length;d>s;s++)n=p[s],n.contribution_amount=numeral(n.contribution_amount).format("0,000");return console.log(u),$.isEmptyObject(u)?($(".loader").hide(),$("#details").html("<h2>Sorry. Page not found</h2>"),$("#details").css({textAlign:"center"}),$("#details").show(),$("#dataContainer").show(),!1):(void 0!==u.votes&&u.votes.forEach(function(e){var t;return t=moment(e.legislation.date_considered,"YYYY-MM-DD"),e.legislation.date_considered=t.format("L")}),f=$("#person-info-template").html(),a=Handlebars.compile(f),$(".loader").hide(),$("#details").show(),o=a(u),$("#details").html(o),$("#dataContainer").css({display:"block"}),y(u),O(u,r),$(".vote").on("click",function(e){var t,a;return t=e.currentTarget.id,a=e.currentTarget.dataset.legislationName,void 0===a&&(a=u.full_name),$("#myModalLabel").text(a+" ("+u.gov_alt_name+")"),$("#conversation").modal("show"),b(t,"http://govwiki.us/"+t,a)}),$("#stantonIcon a").text("Return to "+u.gov_alt_name),window.DISQUSWIDGETS.getCount())},error:function(e){return console.log(e)}})),$(function(){var e,t,a;return e=$("#user"),t=e.find("a"),console.log(authorized),console.log(user),console.log(user.username),authorized?(a=$("#user-text").find("a"),a.html("Logged in as "+user.username+a.html()),t.html("Sign Out"+t.html()).click(function(){return window.location="/logout"})):t.html("Login / Sign Up"+t.html()).click(function(){return showModal("/login")})})},{"./govmap.coffee":1,"./govselector.coffee":2,"./templates2.coffee":5,"./wikipedia.coffee":6}],4:[function(e,t){var a,n,r,o,i,s,l;a=function(e,t){return null==t&&(t=5),function(a,n){var r,s,l,c,d,u,p,f;for(p=function(e,t){var a,n,r;for(a=0,n=t.length;n>a;a++)if(r=t[a],!r.test(e))return!1;return!0},d=o(a),f=d[0],u=d[1],c=[],s=0,l=e.length;l>s&&(r=e[s],!(c.length>=t));s++)GOVWIKI.state_filter&&r.state!==GOVWIKI.state_filter||GOVWIKI.gov_type_filter&&r.type!==GOVWIKI.gov_type_filter||p(r.name,u)&&c.push($.extend({},r));i(c,f,u),n(c)}},i=function(e,t,a){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],n.gov_name=l(n.name,t,a);return e},l=function(e,t,a){return a.forEach(function(a,n){return e=e.replace(a,"<b>"+t[n]+"</b>")}),e},s=function(e){return e.replace(/<[^<>]*>/g,"")},n=function(e){var t;return t=e.trim(""+e),t=t.replace(/ +/g," ")},r=function(e){return n(e).split(" ")},o=function(e){var t,a;return a=r(e),t=a.map(function(e){return new RegExp(""+e,"i")}),[a,t]},t.exports=a},{}],5:[function(e,t){var a,n,r,o,i,s,l,c,d,u,p,f,h,m,g,v,_,y,w;i={},s={},h=function(e,t,a){var n,r;return r=a[e],a[e]?"web_site"===e?"<a target='_blank' href='"+r+"'>"+r+"</a>":""!==t?a[e+"_rank"]&&a.max_ranks&&a.max_ranks[e+"_max_rank"]?(r=numeral(r).format(t),n="No title",GOVWIKI.fusion.rows.forEach(function(t){return t[2]===e?n=t[3]:void 0}),r+" <a class='rank' data-field='"+e+"_rank' title='"+n+" ranks' data-mask='"+t+"''> ("+a[e+"_rank"]+" of "+a.max_ranks[e+"_max_rank"]+")</a>"):numeral(r).format("number_of_full_time_employees"===e?"0,0":t):r.length>20&&"open_enrollment_schools"===e?r=r.substring(0,19)+("<div style='display:inline;color:#074d71'  title='"+r+"'>&hellip;</div>"):r.length>20&&"parent_trigger_eligible_schools"===e?r=r.substring(0,19)+("<div style='display:inline;color:#074d71'  title='"+r+"'>&hellip;</div>"):r.length>21?r=r.substring(0,21):r:""},f=function(e){return s[e]},p=function(e){var t;return null!=i[e]?i[e]:(t=e.replace(/_/g," "),t=t.charAt(0).toUpperCase()+t.substring(1))},u=function(e,t){var a;return"_"===substr(e,0,1)?"<div>\n    <span class='f-nam' >"+p(e)+"</span>\n    <span class='f-val'>&nbsp;</span>\n</div>":(a=t[e])?"<div>\n    <span class='f-nam'  >"+p(e)+"<div></span>\n    <span class='f-val'>"+h(e,t)+"</span>\n</div>":""},v=function(e,t,a){var n;return n="",e=p(e),"heading"===t&&(0!==a&&(n+="<br/>"),n+="<div><span class='f-nam'>"+e+"</span><span class='f-val'> </span></div>"),n},m=function(e,t,a){var n,r,o,i,s,l,c,d;for(s="",l=c=0,d=e.length;d>c;l=++c)i=e[l],"object"==typeof i?"heading"===i.mask?(s+=v(i.name,i.mask,l),o=""):(o=h(i.name,i.mask,t),""!==o&&"0"!==o?(n=p(i.name),r=f(i.name)):o=""):(o=h(i,"",t),""!==o&&(n=p(i),r=f(n))),""!==o&&(s+=a({name:n,value:o,help:r}));return s},g=function(e,t){var a,n,r,i,s,l,c,d;for(r="",c="0,0",a="",i=!1,s=0,l=e.length;l>s;s++)n=e[s],a!==n.category_name&&(a=n.category_name,"Overview"===a?r+=t({name:"<b>"+a+"</b>",genfund:"",otherfunds:"",totalfunds:""}):"Revenues"===a?(r+="</br>",r+="<b>"+t({name:a,genfund:"General Fund",otherfunds:"Other Funds",totalfunds:"Total Gov. Funds"})+"</b>",i=!0):(r+="</br>",r+=t({name:"<b>"+a+"</b>",genfund:"",otherfunds:"",totalfunds:""}),i=!0)),"General Fund Balance"===n.caption||"Long Term Debt"===n.caption?r+=t({name:n.caption,genfund:o(n.genfund,c,'<span class="currency-sign">$</span>')}):"Total Revenues"===(d=n.caption)||"Total Expenditures"===d||"Surplus / (Deficit)"===d||i?(r+=t({name:n.caption,genfund:o(n.genfund,c,'<span class="currency-sign">$</span>'),otherfunds:o(n.otherfunds,c,'<span class="currency-sign">$</span>'),totalfunds:o(n.totalfunds,c,'<span class="currency-sign">$</span>')}),i=!1):r+=t({name:n.caption,genfund:o(n.genfund,c),otherfunds:o(n.otherfunds,c),totalfunds:o(n.totalfunds,c)});return r},w=function(e){return e.replace(/[\s\+\-]/g,"_")},y=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},o=function(e,t,a){var n;return null==a&&(a=""),e=numeral(e),0>e?(n=e.format(t).toString(),n=n.replace(/-/g,""),"("+a+('<span class="fin-val">'+n+"</span>")+")"):(e=e.format(t),""+a+('<span class="fin-val">'+e+"</span>"))},_=function(e,t,a,n){var r,o,i,s,l,c,d,u,p,f,h,v,_,b,I,C,k,x,T,O,S;for(u=e,S=n.templates,k={},p={title:t.name,wikipedia_page_exists:t.wikipedia_page_exists,wikipedia_page_name:t.wikipedia_page_name,transparent_california_page_name:t.transparent_california_page_name,latest_audit_url:t.latest_audit_url,tabs:[],tabcontent:""},c=d=0,f=u.length;f>d;c=++d)O=u[c],p.tabs.push({tabid:w(O.name),tabname:O.name,active:c>0?"":"active"});for(c=_=0,h=u.length;h>_;c=++_){switch(O=u[c],o={tabid:w(O.name),tabname:O.name,active:c>0?"":"active",tabcontent:""},O.name){case"Overview + Elected Officials":for(o.tabcontent+=m(O.fields,t,S["tabdetail-namevalue-template"]),console.log(t),x=t.elected_officials,c=b=0,v=x.length;v>b;c=++b)I=x[c],C={title:""!==I.title?"Title: "+I.title:void 0,name:""!==I.full_name?"Name: "+I.full_name:void 0,email:I.email_address?"Email: "+I.email_address:void 0,telephonenumber:null!==I.telephone_number&&void 0!==I.telephone_number?"Telephone Number: "+I.telephone_number:void 0,termexpires:I.term_expires?"Term Expires: "+I.term_expires:"Term Expires: ",altTypeSlug:t.alt_type_slug,nameSlug:t.slug,slug:I.slug},C.image=""!==I.photo_url&&void 0!==I.photo_url?'<img src="'+I.photo_url+'" class="portrait" alt="" />':"",o.tabcontent+=S["tabdetail-official-template"](C);break;case"Employee Compensation":l="",l+=m(O.fields,t,S["tabdetail-namevalue-template"]),o.tabcontent+=S["tabdetail-employee-comp-template"]({content:l}),k["median-comp-graph"]||(s=!0,0===t.median_salary_per_full_time_emp&&(s=!1),0===t.median_benefits_per_ft_emp&&(s=!1),0===t.median_wages_general_public&&(s=!1),0===t.median_benefits_general_public&&(s=!1),T=340,r=470,$(window).width()<490&&(T=300,r=300),i=function(){return setTimeout(function(){var e,a,n,r;r=new google.visualization.DataTable,r.addColumn("string","Median Compensation"),r.addColumn("number","Wages"),r.addColumn("number","Bens."),r.addRows([[y(t.name+"\n Employees"),t.median_salary_per_full_time_emp,t.median_benefits_per_ft_emp],["All \n"+y(t.name+" \n Residents"),t.median_wages_general_public,t.median_benefits_general_public]]),a=new google.visualization.NumberFormat({groupingSymbol:",",fractionDigits:"0"}),a.format(r,1),a.format(r,2),n={title:"Median Total Compensation - Full Time Workers: \n Government vs. Private Sector",titleTextStyle:{fontSize:12},tooltip:{textStyle:{fontSize:12}},width:T,height:300,isStacked:"true",colors:["#005ce6","#009933"]},e=new google.visualization.ColumnChart(document.getElementById("median-comp-graph")),e.draw(r,n)},1e3)},s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["median-comp-graph"]="median-comp-graph"),k["median-pension-graph"]||(s=!0,t.hasOwnProperty("median_pension_30_year_retiree")&&0!==t.median_pension_30_year_retiree||(s=!1),i=function(){return setTimeout(function(){var e,a,n,r;r=new google.visualization.DataTable,r.addColumn("string","Median Pension"),r.addColumn("number","Wages"),r.addRows([["Pension for \n Retiree w/ 30 Years",t.median_pension30_year_retiree]]),a=new google.visualization.NumberFormat({groupingSymbol:",",fractionDigits:"0"}),a.format(r,1),n={title:"Median Total Pension",titleTextStyle:{fontSize:12},tooltip:{textStyle:{fontSize:12}},width:T,height:300,bar:{groupWidth:"30%"},isStacked:"true",colors:["#005ce6","#009933"]},e=new google.visualization.ColumnChart(document.getElementById("median-pension-graph")),e.draw(r,n)},1e3)},s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["median-pension-graph"]="median-pension-graph");break;case"Financial Health":l="",l+=m(O.fields,t,S["tabdetail-namevalue-template"]),o.tabcontent+=S["tabdetail-financial-health-template"]({content:l}),k["public-safety-pie"]||"School District"===t.alt_type||(s=!0,0===t.public_safety_exp_over_tot_gov_fund_revenue&&(s=!1),i=function(){return setTimeout(function(){var e,a,n;n=new google.visualization.DataTable,n.addColumn("string","Public Safety Expense"),n.addColumn("number","Total"),n.addRows([["Public Safety Exp",1-t.public_safety_exp_over_tot_gov_fund_revenue],["Other",t.public_safety_exp_over_tot_gov_fund_revenue]]),a={title:"Public safety expense",titleTextStyle:{fontSize:12},tooltip:{textStyle:{fontSize:12}},width:T,height:300,is3D:"true",colors:["#005ce6","#009933"],slices:{1:{offset:.2}},pieStartAngle:45},e=new google.visualization.PieChart(document.getElementById("public-safety-pie")),e.draw(n,a)},1e3)},s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["public-safety-pie"]="public-safety-pie"),k["fin-health-revenue-graph"]||"School District"===t.alt_type||(s=!0,0===t.total_revenue_per_capita&&(s=!1),i=function(){return setTimeout(function(){var e,a,n;n=new google.visualization.DataTable,n.addColumn("string","Per Capita"),n.addColumn("number","Rev."),n.addRows([["Total Revenue \n Per Capita",t.total_revenue_per_capita],["Median Total \n Revenue Per \n Capita For All Cities",420]]),a={title:"Total Revenue",titleTextStyle:{fontSize:12},tooltip:{textStyle:{fontSize:12}},width:T,height:300,isStacked:"true",colors:["#005ce6","#009933"],"chartArea.width":"100%"},e=new google.visualization.ColumnChart(document.getElementById("fin-health-revenue-graph")),e.draw(n,a)},1e3)},s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["fin-health-revenue-graph"]="fin-health-revenue-graph"),k["fin-health-expenditures-graph"]||"School District"===t.alt_type||(s=!0,0===t.total_expenditures_per_capita&&(s=!1),i=function(){return setTimeout(function(){var e,a,n;n=new google.visualization.DataTable,n.addColumn("string","Per Capita"),n.addColumn("number","Exp."),n.addRows([["Total Expenditures \n Per Capita",t.total_expenditures_per_capita],["Median Total \n Expenditures \n Per Capita \n For All Cities",420]]),a={title:"Total Expenditures",titleTextStyle:{fontSize:12},tooltip:{textStyle:{fontSize:12}},width:T,height:300,isStacked:"true",colors:["#005ce6","#009933"],"chartArea.width":"100%"},s&&(e=new google.visualization.ColumnChart(document.getElementById("fin-health-expenditures-graph")),e.draw(n,a))},1e3)},google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["fin-health-expenditures-graph"]="fin-health-expenditures-graph");break;case"Financial Statements":t.financial_statements&&(l="",l+=g(t.financial_statements,S["tabdetail-finstatement-template"]),o.tabcontent+=S["tabdetail-financial-statements-template"]({content:l}),k["total-revenue-pie"]||(s=!0,0===t.financial_statements.length&&(s=!1),i=function(){return setTimeout(function(){var e,a,n,o,i,l,c,d,u;for(u=new google.visualization.DataTable,u.addColumn("string","Total Gov. Expenditures"),u.addColumn("number","Total"),d=[],c=t.financial_statements,i=0,n=c.length;n>i;i++)a=c[i],"Revenues"===a.category_name&&"Total Revenues"!==a.caption&&(l=[a.caption,parseInt(a.totalfunds)],d.push(l));u.addRows(d),o={title:"Total Revenues",titleTextStyle:{fontSize:16},tooltip:{textStyle:{fontSize:12}},width:r,height:350,pieStartAngle:60,sliceVisibilityThreshold:.05,forceIFrame:!0,chartArea:{width:"90%",height:"75%"}},s&&(e=new google.visualization.PieChart(document.getElementById("total-revenue-pie")),e.draw(u,o))},1e3)}),s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["total-revenue-pie"]="total-revenue-pie",k["total-expenditures-pie"]||(s=!0,0===t.financial_statements.length&&(s=!1),i=function(){return setTimeout(function(){var e,a,n,o,i,l,c,d,u;for(u=new google.visualization.DataTable,u.addColumn("string","Total Gov. Expenditures"),u.addColumn("number","Total"),d=[],c=t.financial_statements,i=0,n=c.length;n>i;i++)a=c[i],"Expenditures"===a.category_name&&"Total Expenditures"!==a.caption&&(l=[a.caption,parseInt(a.totalfunds)],d.push(l));u.addRows(d),o={title:"Total Expenditures",titleTextStyle:{fontSize:16},tooltip:{textStyle:{fontSize:12}},width:r,height:350,pieStartAngle:60,sliceVisibilityThreshold:.05,forceIFrame:!0,chartArea:{width:"90%",height:"75%"}},s&&(e=new google.visualization.PieChart(document.getElementById("total-expenditures-pie")),e.draw(u,o))},1e3)}),s&&google.load("visualization","1.0",{packages:"corechart",callback:i()}),k["total-expenditures-pie"]="total-expenditures-pie");break;default:o.tabcontent+=m(O.fields,t,S["tabdetail-namevalue-template"])}p.tabcontent+=S["tabdetail-template"](o)}return S["tabpanel-template"](p)},l=function(e){var t,a,n,r,o,i,s,l;for(t={},n=0,r=e.length;r>n;n++)for(l=e[n],s=l.fields,i=0,o=s.length;o>i;i++)a=s[i],t[a]=1;return t},c=function(e){var t,a;t={};for(a in e)t[a]=1;return t},d=function(e,t){var a,n,r,o;n=l(e),r=c(t),o=[];for(a in r)n[a]||o.push(a);return o},n=function(e,t){var a,n;return null==e&&(e=[]),a=$.extend(!0,[],e),n={name:"Other",fields:d(a,t)},a.push(n),a},r=function(e){var t,a,n,r,o,l,c,d,u,p,f,h,m,g,v,_,y,w,b,$,I,C,k,x,T,O,S,V;for(T={},S=[],d=function(){var t,a,n,r,o,i;for(t={},i=e.columns,n=r=0,o=i.length;o>r;n=++r)a=i[n],t[a]=n;return t},V=function(e,t,a){return t[a[e]]},u=function(e){var t,a,n;t=[];for(a in e)n={},n.name=a,n.fields=e[a],t.push(n);return t},o=d(e.col_hash),I=0,C=e.rows,p=f=0,h=C.length;h>f;p=++f)x=C[p],r=V("general_category",x,o),l=V("field_name",x,o),l||(l="_"+String(++I)),i[V("field_name",x,o)]=V("description",x,o),s[l]=V("help_text",x,o),r&&(null==T[r]&&(T[r]=[]),T[r].push({n:V("n",x,o),name:l,mask:V("mask",x,o)}));for(t=Object.keys(T),n={},_=0,m=t.length;m>_;_++){for(r=t[_],n[r]||(n[r]=T[r][0].n),c=[],k=T[r],w=0,g=k.length;g>w;w++)b=k[w],c.push(b);c.sort(function(e,t){return e.n-t.n}),T[r]=c}a=[];for(r in n)y=n[r],a.push({category:r,n:y});for(a.sort(function(e,t){return e.n-t.n}),O={},$=0,v=a.length;v>$;$++)r=a[$],O[r.category]=T[r.category];return S=u(O)},a=function(){function e(){var e,t,a,n,r,o,i,s;for(this.list=[],this.events={},i=["tabpanel-template","tabdetail-template","tabdetail-namevalue-template","tabdetail-finstatement-template","tabdetail-official-template","tabdetail-employee-comp-template","tabdetail-financial-health-template","tabdetail-financial-statements-template","person-info-template"],s=["tab-template"],this.templates={},e=t=0,a=i.length;a>t;e=++t)o=i[e],this.templates[o]=Handlebars.compile($("#"+o).html());for(e=r=0,n=s.length;n>r;e=++r)o=s[e],Handlebars.registerPartial(o,$("#"+o).html())}return e.list=void 0,e.templates=void 0,e.data=void 0,e.events=void 0,e.prototype.add_template=function(e,t){return this.list.push({parent:this,name:e,render:function(e){return this.parent.data=e,_(t,e,this,this.parent)},bind:function(e,t){return this.parent.events[e]?this.parent.events[e].push(t):this.parent.events[e]=[t]},activate:function(e){var t,a,n,r,o,i;if(this.parent.events[e]){for(o=this.parent.events[e],i=[],a=n=0,r=o.length;r>n;a=++n)t=o[a],i.push(t(e,this.parent.data));return i}}})},e.prototype.load_template=function(e,t){return $.ajax({url:t,dataType:"json",cache:!0,async:!1,success:function(t){return function(a){return t.add_template(e,a)}}(this)})},e.prototype.load_fusion_template=function(e,t){return $.ajax({url:t,dataType:"json",cache:!0,async:!1,success:function(t){return function(a){var n;return GOVWIKI.fusion=a,n=r(a),t.add_template(e,n)}}(this)})},e.prototype.get_names=function(){var e,t,a,n,r;for(a=this.list,n=[],e=0,t=a.length;t>e;e++)r=a[e],n.push(r.name);return n},e.prototype.get_index_by_name=function(e){var t,a,n,r,o;for(r=this.list,t=a=0,n=r.length;n>a;t=++a)o=r[t],o.name===e;return-1},e.prototype.get_html=function(e,t){return-1===e?"":this.list[e]?this.list[e].render(t):""},e.prototype.activate=function(e,t){return this.list[e]?this.list[e].activate(t):void 0},e}(),t.exports=a},{}],6:[function(e,t){var a,n;$(function(){return window.get_wikipedia_article=n,window.create_wikipedia_article=a}),n=function(e){var t;return t=e.replace(/.*\/([^\/]*)$/,"$1"),$.getJSON("http://en.wikipedia.org/w/api.php?action=parse&page="+t+"&prop=text&format=json&callback=?",function(e){return $("#wikipediaTitle").html(e.parse.title),$("#wikipediaArticle").html(e.parse.text["*"]),$("#wikipediaArticle").find("a:not(.references a)").attr("href",function(){return"http://www.wikipedia.org"+$(this).attr("href")}),$("#wikipediaArticle").find("a").attr("target","_blank")})},a=function(){return alert("Not implemented")},t.exports={get_wikipedia_article:n}},{}]},{},[3]);