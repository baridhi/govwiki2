<style>
    .disabled {
        cursor: not-allowed;
        color: #BBBBBB;
        background-color: #F3F3F3;
    }

    button {
        border-radius: 3px;
        display: inline-block;
        color: #ffffff;
        background-color: #2196f3;
        border: none;
        text-align: center;
        vertical-align: middle;
        transition: all 0.2s ease-in-out;
        text-transform: uppercase;
        background-image: none;
        white-space: nowrap;
        padding: 6px 16px;
        font-size: 13px;
        line-height: 1.846;
        animation-duration: 0.0001s;
        animation-name: mui-btn-inserted;
    }

    button:hover {
        background-color: #0d87e9;
        color: white;
        border-color: rgba(0,0,0,0);
    }

    button:active {
        color: #ffffff;
        background-color: #0c7cd5;
        border-color: rgba(0,0,0,0);
    }

    .pensions-table {
        width: 100%;
        max-width: 100%;
        border-collapse: collapse;
        border-spacing: 0;
    }

    .pensions-table thead th {
        border-bottom: 2px solid #dddddd;
        padding: 8px;
    }

    .caption {
        color: #074d71;
        text-decoration: none;
        position: relative;
        cursor: pointer;
    }

    .caption:hover {
        color: #2196f3;
        text-decoration: underline;
    }

    .caption-left {
        margin-right: 21px;
    }

    .caption-right {
        width: 21px;
        height: 100%;
        position: absolute;
        top: 0;
        right: 0;
    }

    .sort .caption-right {
        background: url("data:image/gif;base64,R0lGODlhFQAJAIAAACMtMP///yH5BAEAAAEALAAAAAAVAAkAAAIXjI+AywnaYnhUMoqt3gZXPmVg94yJVQAAOw==") no-repeat center;
    }

    .sort__asc .caption-right {
        background: url("data:image/gif;base64,R0lGODlhFQAEAIAAACMtMP///yH5BAEAAAEALAAAAAAVAAQAAAINjI8Bya2wnINUMopZAQA7") no-repeat center;
    }

    .sort__desc .caption-right {
        background: url("data:image/gif;base64,R0lGODlhFQAEAIAAACMtMP///yH5BAEAAAEALAAAAAAVAAQAAAINjB+gC+jP2ptn0WskLQA7") no-repeat center;
    }

    .pensions {
        display: block;
        width: 80%;
        margin: 0 auto;
    }

    .column-currency {
        text-align: right;
    }

    .pensions-table {
        font-size: 13px;
    }

    .pensions-table tbody td {
        border-top: 1px solid #dddddd;
        padding: 8px;
        line-height: 1.846;
        vertical-align: middle;
        color: #666;
    }

    .pensions-table>tbody>tr:nth-of-type(odd) {
        background-color: #f9f9f9;
    }

    .pensions-table-footer {
        padding: 2px;
    }

    .pensions-table-paginator,
    .pensions-table-paginator-page input {
        color: #074d71;
    }

    .pensions-table-paginator li:not(:first-child) {
        border-left: none;
    }

    .pensions-table-paginator {
        list-style: none;
        padding: 0;
        float: left;
    }
    .pensions-table-footer-count {
        float: right;
        margin: 1em;
        height: 28px;
        line-height: 28px;
    }

    .pensions-table-paginator-button,
    .pensions-table-paginator-page {
        border: 1px solid #ddd;
        float: left;
        padding: 4px;
        min-width: 20px;
        text-align: center;
    }
    .pensions-table-paginator-button {
        cursor: pointer;
    }

    .pensions-table-paginator-button:hover {
        background-color: #eee;
        color: #0a6ebd;
    }

    .pensions-table-paginator li:first-child {
        border-bottom-left-radius: 3px;
        border-top-left-radius: 3px;
    }

    .pensions-table-paginator .pensions-table-paginator-page {
        padding: 0;
    }

    .pensions-table-paginator-page input {
        border: 0;
        height: 26px;
        padding: 0;
        padding-left: 5px;
        width: 55px;
    }

    .pensions-table-paginator li:last-child {
        border-bottom-right-radius: 3px;
        border-top-right-radius: 3px;
    }

    .pensions-table-footer-filter,
    .pensions-table-footer-selector {
        float: left;
        margin: 1em 0 1em 1em;
    }

    .pensions input[type='text'] {
        height: 25px;
    }
    .pensions select,
    .pensions button {
        height: 26px;
    }

    .pensions select {
        padding: 0 20px 0 10px;
    }

    .pensions input[type='text'],
    .pensions button {
        padding: 0 10px;
    }

    .pensions input[type='text'],
    .pensions select {
        border: 0;
        border-radius: 0;
        color: #666;
        appearance: none;
        -webkit-appearance: none;
    }

    .pensions input[type='text'] {
        padding: 0;
        box-shadow: inset 0 -1px 0 #ddd;
    }

    .pensions input[type='text']:focus,
    .pensions select:focus {
        box-shadow: inset 0 -2px 0 #2196f3;
        outline: 0;
    }

    .pensions select {
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAAJ1BMVEVmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmaP/QSjAAAADHRSTlMAAgMJC0uWpKa6wMxMdjkoAAAANUlEQVR4AeXJyQEAERAAsNl7Hf3X6xt0QL6JpZWq30pdvdadme+0PMdzvHm8YThHcT1H7K0BtOMDniZhWOgAAAAASUVORK5CYII=);
        background-size: 13px;
        background-repeat: no-repeat;
        background-position: right center;
        box-shadow: inset 0 -1px 0 #ddd;
        font-size: 16px;
        line-height: 1.5;
        background-color: transparent;
    }

    .pensions select:focus {
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAAJ1BMVEUhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISF8S9ewAAAADHRSTlMAAgMJC0uWpKa6wMxMdjkoAAAANUlEQVR4AeXJyQEAERAAsNl7Hf3X6xt0QL6JpZWq30pdvdadme+0PMdzvHm8YThHcT1H7K0BtOMDniZhWOgAAAAASUVORK5CYII=);
    }

    .ms-parent {
        height: 25px;
    }

    .ms-choice:hover {
        background-color: transparent;
        color: initial;
        border-color: rgb(170, 170, 170);
    }

    .clearfix {
        clear: both;
    }

    .loader {
        margin: 60px auto;
        font-size: 4px;
        position: relative;
        text-indent: -9999em;
        border-top: 2px solid rgba(200,200,200,0.5);
        border-right: 2px solid rgba(200,200,200,0.5);
        border-bottom: 2px solid rgba(200,200,200,0.5);
        border-left: 2px solid #0b4d70;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation: load8 0.7s infinite linear;
        animation: load8 0.7s infinite linear;
    }

    .loader,
    .loader:after {
        border-radius: 50%;
        width: 10em;
        height: 10em;
    }

    .loader_wrap {
        width: 100px;
        overflow: hidden;
        margin: 0 auto;
    }

    @keyframes mui-btn-inserted {
        from {
            -ms-zoom: 1;
        }
        to {
            -ms-zoom:1;
        }
    }

    @-webkit-keyframes load8 {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
        }
    }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/multiple-select/1.2.0/multiple-select.min.css">

<div class="pensions">
    {#<div class="pensions-table-footer">
        <ul class="pensions-table-paginator">
            <li class="pensions-table-paginator-button pensions-table-paginator-first">
                &lt;&lt;
            </li>
            <li class="pensions-table-paginator-button pensions-table-paginator-previous">
                &lt;
            </li>
            <li class="pensions-table-paginator-page">
                <input type="number" min="1" max="">
            </li>
            <li class="pensions-table-paginator-button pensions-table-paginator-next">
                &gt;
            </li>
            <li class="pensions-table-paginator-button pensions-table-paginator-last">
                &gt;&gt;
            </li>
        </ul>
        <div class="pensions-table-footer-filter">
            Filter:
            <select class="filter-field">
                {%- for name, config in fields -%}
                    <option value="{{- name -}}" data-type="{{- config.type -}}">
                        {{- config.title -}}
                    </option>
                {%- endfor -%}
            </select>
            <select class="filter-operation-string">
                <option value="eq">=</option>
                <option value="contains">contains</option>
                <option value="neq">&lt;&gt;</option>
            </select>
            <select class="filter-operation-number">
                <option value="lt">&lt;</option>
                <option value="lte">&lt;=</option>
                <option value="eq">=</option>
                <option value="neq">&lt;&gt;</option>
                <option value="gte">&gt;=</option>
                <option value="gt">&gt;</option>
                <option value="between">between</option>
            </select>
            <input type="text" class="filter-value">
            <input type="text" class="filter-value-max">
            <button class="filter-button" type="button">Filter</button>
            <button class="filter-button-reset" type="button">Reset filter</button>
        </div>
        <div class="pensions-table-footer-selector">
            <select multiple="multiple"></select>
            <button class="pensions-table-footer-selector-apply" type="button">Apply</button>
        </div>
        <div class="pensions-table-footer-count">
            <select class="pensions-table-per-page">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="75">15</option>
                <option value="100">100</option>
            </select>
            per page.
            Total pages: <span class="count"></span>
        </div>
        <div class="clearfix"></div>
    </div>
    <table class="pensions-table">
    <thead>
        <tr>
            <th class="sort" data-name="employee_name">
                <div class="caption">
                    <div class="caption-left">Employee</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="job_title">
                <div class="caption">
                    <div class="caption-left">Job Title</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="employer">

                <div class="caption">
                    <div class="caption-left">Employer</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="pension_system">

                <div class="caption" style="width: 140px">
                    <div class="caption-left">Pension System</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="region">
                <div class="caption">
                    <div class="caption-left">Region</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="pension_amount">
                <div class="caption" style="width: 100px">
                    <div class="caption-left">Pension</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="benefits_amount">
                <div class="caption">
                    <div class="caption-left">Benefits</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="disability_amount">
                <div class="caption">
                    <div class="caption-left">Disability</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="total_amount">
                <div class="caption" style="width: 100px">
                    <div class="caption-left">Total</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="notes">
                <div class="caption">
                    <div class="caption-left">Notes</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="total_net_of_one_time_payments">
                <div class="caption" style="width: 140px">
                    <div class="caption-left">Total Net Of One Time Payments</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="years_of_service">
                <div class="caption" style="width: 85px">
                    <div class="caption-left">Years Of Service</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="year_of_retirement">
                <div class="caption">
                    <div class="caption-left">Year Of Retirement</div>
                    <div class="caption-right"></div>
                </div>
            </th>
            <th class="sort" data-name="year">
                <div class="caption" style="width: 50px">
                    <div class="caption-left">Year</div>
                    <div class="caption-right"></div>
                </div>
            </th>
        </tr>
    </thead>
    <tbody>
        {%- block data -%}
        {%- endblock data -%}
    </tbody>
    </table>#}
</div>

{%- set _code = block('code') -%}
{%- if (_code) -%}
    {%- if (debug) -%}
        <script src="https://code.jquery.com/jquery-1.12.4.min.js"
                integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
                crossorigin="anonymous">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/multiple-select/1.2.0/multiple-select.min.js">
        </script>

        {{- _code|raw -}}
    {%- else -%}
        {%- jshrink -%}
            {{- _code|raw -}}
        {%- endjshrink -%}
    {%- endif -%}
{%- endif -%}



{#

<script>
    // We make sure that $ point to jQuery.
    if (! $ && jQuery) {
        window.$ = jQuery;
    }

    var ENDPOINT = '{{- endPoint -}}';

    var Table = (function() {
        /**
         * Sorting order.
         *
         * @const
         */
        var SORT_ORDER = {
            none: null,
            asc: 'asc',
            desc: 'desc'
        };

        var fieldsConfig = {
            employee_name: {
                title: 'Employee',
                type: 'string'
            },
            job_title: {
                title: 'Job Title',
                type: 'string'
            },
            employer: {
                title: 'Employer',
                type: 'string'
            },
            pension_system: {
                title: 'Pension System',
                type: 'string'
            },
            region: {
                title: 'Region',
                type: 'string'
            },
            pension_amount: {
                title: 'Pension',
                type: 'currency'
            },
            benefits_amount: {
                title: 'Benefis',
                type: 'currency'
            },
            disability_amount: {
                title: 'Disability',
                type: 'currency'
            },
            total_amount: {
                title: 'Total',
                type: 'currency'
            },
            notes: {
                title: 'Notes',
                type: 'string'
            },
            total_net_of_one_time_payments: {
                title: 'Total Net Of One Time Payments',
                type: 'currency'
            },
            years_of_service: {
                title: 'Years Of Service',
                type: 'number'
            },
            year_of_retirement: {
                title: 'Year Of Retirement',
                type: 'number'
            },
            year: {
                title: 'Year',
                type: 'number'
            }
        };

        var DEFAULTS_COLUMNS = [
            'employee_name',
            'job_title',
            'employer',
            'pension_system',
            'total_net_of_one_time_payments'
        ];

        function intersect(first, second){
            var ai = 0;
            var bi=0;
            var result = [];

            while( ai < a.length && bi < b.length ) {
                if (a[ai] < b[bi]) {
                    ai++;
                } else if (a[ai] > b[bi]) {
                    bi++;
                } else {
                    result.push(a[ai]);
                    ai++;
                    bi++;
                }
          }

          return result;
        }

        function first(arr) {
            var i;

            for (i in arr){
                return arr[i];
            }
        }

        function Table(selector, endPoint) {
            var self = this;

            var field;

            var filterFieldSelector;
            var filterValueSelector;
            var maxPerPageSelector;
            var columnsSelector;

            this.$el = $(selector);

            this.$('.filter-operation-number').hide();

            this._state = {
                page: 1,
                maxPerPage: 10,
                pagesCount: 0,
                sortField: null,
                sortOrder: SORT_ORDER.none,
                filterField: 'employee_name',
                filterOperation: null,
                filterValue: null,
                showedColumns: DEFAULTS_COLUMNS
            };

            this._endPoint = endPoint;

            // Pagination handlers.
            this.$('.pensions-table-paginator-first').click(function() {
                self.goTo(1);
            });
            this.$('.pensions-table-paginator-previous').click(function() {
                self.goTo(self._state.page - 1);
            });
            this.$('.pensions-table-paginator-next').click(function() {
                self.goTo(self._state.page + 1);
            });
            this.$('.pensions-table-paginator-last').click(function() {
                self.goTo(self._state.pagesCount);
            });
            this.$('.pensions-table-paginator-page input').change(function(event) {
                self.goTo(event.target.value);
            });

            // Sort handler.
            this.$('.sort').click(function (event) {
                self._sort($(this));

                event.preventDefault();
                event.stopPropagation();
            });

            filterFieldSelector = this.$('.filter-field');
            filterValueSelector = this.$('.filter-value');

            filterFieldSelector.change(changeFilterSelectors);
            filterValueSelector.change(changeFilterSelectors);
            this.$('.filter-operation-string').change(changeFilterSelectors);
            this.$('.filter-operation-number').change(changeFilterSelectors);
            this.$('.filter-value-min').change(changeFilterSelectors);
            this.$('.filter-value-max').change(changeFilterSelectors);

            maxPerPageSelector = this.$('.pensions-table-per-page');

            maxPerPageSelector.change(function() {
                self._state.maxPerPage = Number(maxPerPageSelector.val());
                self.render();
            });

            this.$('.filter-button').click(function () {
                self.render();
            });

            this.$('.filter-button-reset').click(function () {
                self._state.filterField = 'employee_name';
                self._state.filterOperation = null;
                self._state.filterValue = null;
                self._state.maxPerPage = 10;
                self._state.showedColumns = DEFAULTS_COLUMNS;

                filterFieldSelector
                    .find(':selected')
                    .removeAttr('selected');

                filterFieldSelector
                    .find('option[value="employee_name"]')
                    .attr('selected', 'selected');

                maxPerPageSelector
                    .find(':selected')
                    .removeAttr('selected');

                maxPerPageSelector
                    .find('option[value="25"]')
                    .attr('selected', 'selected');

                filterValueSelector.val('');
                filterValueSelector.val('');
                self.render();
            });

            function changeFilterSelectors() {
                var newField = filterFieldSelector.val().trim();
                var newOperation = self._getFilterOperation(newField);
                var newValue = self._getFilterValue(newOperation);

                self._state.filterField = newField;
                self._state.filterOperation = newOperation;
                self._state.filterValue = newValue;

                self._updateFilter();
            }

            // Add all columns.
            columnsSelector = this.$('.pensions-table-footer-selector select');
            for (field in fieldsConfig) {
                columnsSelector.append(
                    '<option value="'+ field +'">'+fieldsConfig[field].title+'</option>'
                )
            }

            this.$('.pensions-table-footer-selector-apply').click(function() {
                self.render();
            });

            // Initialize multi select.
            columnsSelector.multipleSelect({
                filter: true,
                onClick: function() {
                    self._state.showedColumns = columnsSelector
                        .multipleSelect('getSelects');
                },
                onCheckAll: function() {
                    self._state.showedColumns = columnsSelector
                        .multipleSelect('getSelects');
                },
                onUncheckAll: function() {
                    self._state.showedColumns = columnsSelector
                        .multipleSelect('getSelects');
                }
            });

            columnsSelector
                .multipleSelect('setSelects', this._state.showedColumns);
        }

        Table.prototype.$ = function(selector) {
            return this.$el.find(selector);
        };

        Table.prototype.goTo = function(page) {
            var pagesCount = this._state.pagesCount;

            // Check page bound.
            if ((page < 1) || (page > pagesCount)) {
                // Do nothing.
                return;
            }

            this._state.page = page;
            this.render();
        };

        Table.prototype.render = function() {
            var self = this;
            var table = this.$('tbody');

            var sortField = this._state.sortField;
            var showedColumns = this._state.showedColumns;
            var firstShowedColumn = first(showedColumns);

            if ($.inArray(this._state.filterField, showedColumns) === -1) {
                this._state.filterField = firstShowedColumn;
                this._state.filterOperation = null;
                this._state.filterValue = null;
            }

            if (sortField && $.inArray(sortField, showedColumns) === -1) {
                this._state.sortField = firstShowedColumn;
                this._state.sortOrder = SORT_ORDER.none;
            }

            table.html('');

            this.$el.append(
                '<div class="loader_wrap"><div class="loader"></div></div>'
            );

            this._query()
                .done(function (response) {
                    var rows = response.data.rows;
                    var totalCount = response.data.totalCount;

                    self._state.pagesCount = Math.ceil(totalCount / self._state.maxPerPage);
                    self._updateData(rows);
                    self._updatePaginator();
                    self._updateFilter();
                    self._updateTable();
                });
        };

        Table.prototype._updateData = function(data) {
            var i;
            var table = this.$('tbody');

            this.$('.loader_wrap').remove();

            for (i = 0; i < data.length; ++i) {
                table.append(this._renderRow(data[i]));
            }
        };

        Table.prototype._updatePaginator = function() {
            var currentPage = this._state.page;
            var pagesCount = this._state.pagesCount;

            this.$('.pensions-table-paginator-page input')
                .val(currentPage)
                .attr('max', pagesCount);
            this.$('.pensions-table-footer-count .count')
                .text(pagesCount);

            if (currentPage === 1) {
                // Hide previous and first button.
                this.$('.pensions-table-paginator-first').addClass('disabled');
                this.$('.pensions-table-paginator-previous').addClass('disabled');
            } else {
                // Show previous and first button.
                this.$('.pensions-table-paginator-first').removeClass('disabled');
                this.$('.pensions-table-paginator-previous').removeClass('disabled');
            }

            if (currentPage === pagesCount) {
                // Hide next and last button.
                this.$('.pensions-table-paginator-next').addClass('disabled');
                this.$('.pensions-table-paginator-last').addClass('disabled');
            } else {
                // Show next and last button.
                this.$('.pensions-table-paginator-next').removeClass('disabled');
                this.$('.pensions-table-paginator-last').removeClass('disabled');
            }
        };

        Table.prototype._updateFilter = function() {
            var showedColumns = this._state.showedColumns;
            var i;

            var filterFieldSelector = this.$('.filter-field');
            var filterValueSelector = this.$('.filter-value');
            var filterValueMaxSelector = this.$('.filter-value-max');
            var filterOperationString = this.$('.filter-operation-string');
            var filterOperationNumber = this.$('.filter-operation-number');

            var newField = this._state.filterField;
            var newValue = this._state.filterValue;
            var newOperation = this._state.filterOperation;

            if (fieldsConfig[newField].type === 'string') {
                filterOperationNumber.hide();
                filterOperationString.show();
            } else {
                filterOperationNumber.show();
                filterOperationString.hide();
            }

            if (newOperation === 'between') {
                filterValueMaxSelector.show();
            } else {
                filterValueMaxSelector.val('').hide();
            }

            filterFieldSelector.find('option').hide();
            for (i in showedColumns) {
                filterFieldSelector
                    .find('[value="'+ showedColumns[i] +'"]')
                    .show();
            }
            filterFieldSelector.find(':selected').removeAttr('selected');
            filterFieldSelector.find('[value="'+ newField +'"]')
                    .attr('selected', 'selected');

            if (newValue && newValue.indexOf(',') !== -1) {
                newValue = newValue.split(',');

                filterValueSelector.val(newValue[0]);
                filterValueMaxSelector.val(newValue[1]);
            } else {
                filterValueSelector.val(newValue);
            }
        };

        Table.prototype._updateTable = function() {
            var table = this.$('table');
            var showedColumns = this._state.showedColumns;
            var i;

            // Hide all columns.
            table.find('th').hide();
            // Show only selected.
            for (i in showedColumns) {
                table.find('[data-name="'+ showedColumns[i] +'"]').show();
            }
        };

        Table.prototype._query = function() {
            var url = this._endPoint;

            var limit = this._state.maxPerPage;
            var offset = (this._state.page - 1) * limit;

            var filterField = this._state.filterField;
            var filterOperation = this._state.filterOperation;
            var filterValue = this._state.filterValue;

            var sortField = this._state.sortField;
            var sortOrder = this._state.sortOrder;

            var columns = this._state.showedColumns;

            // Add limit and offset.
            url += '?limit=' + limit + '&offset=' + offset;

            // Add required columns.
            url += '&showedColumns=' + columns.join(',');

            // Add filter field name and value.
            if (filterField && filterOperation) {
                url += '&filterField=' + filterField + '&filterValue='
                    + filterValue + '&filterOperation=' + filterOperation;
            }

            // Add sort field name and order.
            if (sortField && sortOrder) {
                url += '&sortField=' + sortField + '&sortOrder='
                    + sortOrder;
            }

            return $.ajax({
                url: url,
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            });
        };

        Table.prototype._sort = function ($element) {
            var fieldName = $element.data('name');

            var currentSortField = this._state.sortField;
            var currentSortOrder = this._state.sortOrder;

            // Reset all sort element classes to initial.
            this.$('.sort').each(function () {
                $(this).attr('class', 'sort');
            });

            if (currentSortField === fieldName) {
                // Update sort order.
                switch (currentSortOrder) {
                    case SORT_ORDER.none:
                        this._state.sortOrder = SORT_ORDER.asc;
                        $element.attr('class', 'sort sort__asc');
                        break;

                    case SORT_ORDER.asc:
                        this._state.sortOrder = SORT_ORDER.desc;
                        $element.attr('class', 'sort sort__desc');
                        break;

                    case SORT_ORDER.desc:
                        this._state.sortOrder = SORT_ORDER.none;
                        $element.attr('class', 'sort');
                        break;
                }
            } else {
                this._state.sortField = fieldName;
                this._state.sortOrder = SORT_ORDER.asc;
                $element.attr('class', 'sort sort__asc');
            }

            this.render();
        };

        Table.prototype._renderRow = function (row) {
            var result = '<tr>';
            var showedColumns = this._state.showedColumns;
            var i;
            var column;

            for (i in showedColumns) {
                column = showedColumns[i];

                if (fieldsConfig[column].type === 'currency') {
                    row[column] = (row[column + '_formatted'])
                        ? '$ ' + row[column + '_formatted']
                        : null
                }
                result += '<td>'+ (row[column] || '') +'</td>';
            }

            return result;
        };

        Table.prototype._getFilterOperation = function (filterName) {
            var type = fieldsConfig[filterName].type;
            if (type === 'currency') {
                type = 'number';
            }

            return this.$('.filter-operation-' + type).val();
        };

        Table.prototype._getFilterValue = function (filterOperation) {
            var value = this.$('.filter-value').val().trim();

            if (filterOperation === 'between') {
                value += ',' + this.$('.filter-value-max').val().trim();
            }

            return value;
        };

        return Table;
    })();

    var table = new Table('.pensions', ENDPOINT);

    table.render();
</script>
#}
